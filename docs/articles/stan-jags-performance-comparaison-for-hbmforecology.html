<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hbm4ecology">
<title>Stan and Jags performance comparaison for Hierarchical Bayesian Modeling for Ecological Data • hbm4ecology</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stan and Jags performance comparaison for Hierarchical Bayesian Modeling for Ecological Data">
<meta property="og:description" content="hbm4ecology">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hbm4ecology</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/hierarchical-exchangeable-cmr.html">Hierarchical Exchangeable Binomial Model for Capture-Mark-Recapture Data</a>
    <a class="dropdown-item" href="../articles/hierarchical-stock-recruitment.html">Hierarchical Stock Recruitment Analysis</a>
    <a class="dropdown-item" href="../articles/hierarchical-successive-removal.html">Hierarchical Successive Removal</a>
    <a class="dropdown-item" href="../articles/namibian-hake-biomass-production.html">Biomass Production Model: The Namibian Hake Fishery</a>
    <a class="dropdown-item" href="../articles/state-space-modeling-of-a-salmon-life-cycle-model.html">State-space Modeling of A. Salmon Life Cycle Model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Stan and Jags performance comparaison for Hierarchical Bayesian Modeling for Ecological Data</h1>
            
      
      
      <div class="d-none name"><code>stan-jags-performance-comparaison-for-hbmforecology.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hbm4ecology</span><span class="op">)</span></span>
<span><span class="co">#&gt; Please visit the site https://Chabert-Liddell.github.io/hbm4ecology/articles/</span></span>
<span><span class="co">#&gt;                           for R case study.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="co">#&gt; rstan (Version 2.21.5, GitRev: 2e1f913d3ca3)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span></span></span>
<span><span class="co">#&gt; ───────────────────────────────────────</span></span>
<span><span class="co">#&gt; tidyverse 1.3.2 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.8     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.0.9</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.2.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 0.3.4     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyr</span>::<span style="color: #00BB00;">extract()</span> masks <span style="color: #0000BB;">rstan</span>::extract()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>  masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>     masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/" class="external-link">GGally</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'GGally':</span></span>
<span><span class="co">#&gt;   method from   </span></span>
<span><span class="co">#&gt;   +.gg   ggplot2</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is posterior version 1.2.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'posterior'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:rstan':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ess_bulk, ess_tail</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     mad, sd, var</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is bayesplot version 1.9.0</span></span>
<span><span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span></span>
<span><span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span></span>
<span><span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span></span>
<span><span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'bayesplot'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:posterior':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rhat</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/shinystan/" class="external-link">shinystan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: shiny</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This is shinystan version 2.6.0</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mcmc-jags.sourceforge.io" class="external-link">rjags</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: coda</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'coda'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:rstan':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     traceplot</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linked to JAGS 4.3.0</span></span>
<span><span class="co">#&gt; Loaded modules: basemod,bugs</span></span></code></pre></div>
<p>In this article we are going to compare the performance of the
Hamiltonian Monte Carlo using <code>rstan</code> and the Monte Carlo
Markov Chain using <code>rjags</code> on the biomass production model
and the hierarchical stock-recruitment model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"BioprodNamibianHake"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SRSalmon"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="biomass-production-model">Biomass Production Model<a class="anchor" aria-label="anchor" href="#biomass-production-model"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stan_model_biomprod</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">data {</span></span>
<span><span class="st">  int N;</span></span>
<span><span class="st">  int Year[N];</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[N] C;</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[N-1] I;</span></span>
<span><span class="st">  int NF;</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">parameters {</span></span>
<span><span class="st">  real&lt;lower=0&gt; r;</span></span>
<span><span class="st">  real&lt;lower=100, upper=15000&gt; K;</span></span>
<span><span class="st">  real&lt;lower=-20, upper=20&gt; log_q;</span></span>
<span><span class="st">  real&lt;lower=-20, upper=20&gt; log_sig2;</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[N] P; //B_t/K</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">transformed parameters {</span></span>
<span><span class="st">  real q;</span></span>
<span><span class="st">  real sig;</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[N] B;</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  q = exp(log_q);</span></span>
<span><span class="st">  sig = sqrt(exp(log_sig2));</span></span>
<span><span class="st">  B = K*P;</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  vector[N-1] h_P;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  P[1] ~ lognormal(0, sig);</span></span>
<span><span class="st">  for (t in 1:(N-1)) {</span></span>
<span><span class="st">      h_P[t] = r * K * P[t] * (1 - P[t]);</span></span>
<span><span class="st">      P[t+1] ~ lognormal(log(P[t] + h_P[t]/K - C[t]/K), sig);</span></span>
<span><span class="st">      I[t] ~ lognormal(log(q*K*P[t+1]), sig);</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">generated quantities {</span></span>
<span><span class="st">  // Abundance prediction</span></span>
<span><span class="st">  vector[N] I_pred;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  for (t in 1:N) {</span></span>
<span><span class="st">    I_pred[t] = lognormal_rng(log(q*K*P[t]), sig);</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">} </span></span>
<span><span class="st"></span></span>
<span><span class="st">"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_list</span> <span class="op">&lt;-</span> <span class="va">BioprodNamibianHake</span></span>
<span><span class="va">dat_list</span><span class="op">$</span><span class="va">I</span> <span class="op">&lt;-</span> <span class="va">BioprodNamibianHake</span><span class="op">$</span><span class="va">I</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="va">dat_list</span><span class="op">$</span><span class="va">NF</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_name</span> <span class="op">&lt;-</span><span class="st">"BiomProd_NamibianHake"</span></span>
<span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sm_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_model.html" class="external-link">stan_model</a></span><span class="op">(</span>model_code <span class="op">=</span>  <span class="va">stan_model_biomprod</span>,</span>
<span>                 model_name <span class="op">=</span>  <span class="va">model_name</span>, <span class="op">)</span></span>
<span><span class="co">#&gt; Trying to compile a simple C file</span></span>
<span><span class="co">#&gt; Running /usr/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; gcc -I"/usr/share/R/include" -DNDEBUG   -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/Rcpp/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/unsupported"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/BH/include" -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/src/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppParallel/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include '/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1      -fpic  -g -O2 -fdebug-prefix-map=/build/r-base-kt0bjq/r-base-4.2.0=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:88,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name ‘namespace’</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       | ^~~~~~~~~</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:17: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘{’ token</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       |                 ^</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:96:10: fatal error: complex: No such file or directory</span></span>
<span><span class="co">#&gt;    96 | #include &lt;complex&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/usr/lib/R/etc/Makeconf:168: foo.o] Error 1</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fit_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sm_hier</span>,</span>
<span>                data <span class="op">=</span> <span class="va">dat_list</span>, </span>
<span>                pars <span class="op">=</span> <span class="cn">NA</span>, <span class="co">#params,</span></span>
<span>                chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co">#            init = lapply(seq(4), function(x)</span></span>
<span>    <span class="co">#               list(P = rep(.5, 25))),</span></span>
<span>                iter <span class="op">=</span> <span class="fl">1e5</span>, </span>
<span>                warmup <span class="op">=</span> <span class="fl">1e4</span>, </span>
<span>                thin <span class="op">=</span> <span class="fl">1</span><span class="co">#,</span></span>
<span><span class="co">#                control = list("adapt_delta" = .9)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'BiomProd_NamibianHake' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">#&gt; Chain 1: Exception: lognormal_lpdf: Location parameter is -nan, but must be finite!  (in 'model238707dbae9c5_BiomProd_NamibianHake' at line 34)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">#&gt; Chain 1: Exception: lognormal_lpdf: Location parameter is -nan, but must be finite!  (in 'model238707dbae9c5_BiomProd_NamibianHake' at line 34)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">#&gt; Chain 1: Exception: lognormal_lpdf: Location parameter is -nan, but must be finite!  (in 'model238707dbae9c5_BiomProd_NamibianHake' at line 34)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">#&gt; Chain 1: Exception: lognormal_lpdf: Location parameter is -nan, but must be finite!  (in 'model238707dbae9c5_BiomProd_NamibianHake' at line 34)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1: Rejecting initial value:</span></span>
<span><span class="co">#&gt; Chain 1:   Error evaluating the log probability at the initial value.</span></span>
<span><span class="co">#&gt; Chain 1: Exception: lognormal_lpdf: Location parameter is -nan, but must be finite!  (in 'model238707dbae9c5_BiomProd_NamibianHake' at line 34)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 3.8e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.38 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:     1 / 100000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10000 / 100000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10001 / 100000 [ 10%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 20000 / 100000 [ 20%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 30000 / 100000 [ 30%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 40000 / 100000 [ 40%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 50000 / 100000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 60000 / 100000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 70000 / 100000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 80000 / 100000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 90000 / 100000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100000 / 100000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 10.4781 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                185.971 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                196.449 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#monitor(rstan::extract(fit_hier, pars = c("r", "q", "sig"), permuted = FALSE, inc_warmup = TRUE))</span></span>
<span><span class="co">#print(fit_hier, pars =  c("r", "q", "sig", "P"))</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biomprod_jags_model_str</span> <span class="op">&lt;-</span>  </span>
<span><span class="st">"model {</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Constants</span></span>
<span><span class="st"># --------------------------------------------------</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Constant needed to prevent Biomass to be negative</span></span>
<span><span class="st">eps &lt;- 0.001</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Biomass(t=1) = alpha * K</span></span>
<span><span class="st">alpha &lt;- 1 </span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Prior </span></span>
<span><span class="st"># ---------------------------------------------------</span></span>
<span><span class="st"></span></span>
<span><span class="st">log_q ~ dunif(-20,20) </span></span>
<span><span class="st">q &lt;- exp(log_q) </span></span>
<span><span class="st"></span></span>
<span><span class="st">r ~ dunif(0.01,3)</span></span>
<span><span class="st">r_p ~ dunif(0.01,3)</span></span>
<span><span class="st"></span></span>
<span><span class="st">K ~ dunif(100,15000) </span></span>
<span><span class="st">K_p ~ dunif(100,15000) </span></span>
<span><span class="st"></span></span>
<span><span class="st"># Process error variance</span></span>
<span><span class="st"></span></span>
<span><span class="st">log_sigma2p ~ dunif(-20,20)</span></span>
<span><span class="st">sigma2p &lt;- exp(log_sigma2p) </span></span>
<span><span class="st">taup &lt;- 1/sigma2p</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Measurement error variance</span></span>
<span><span class="st"></span></span>
<span><span class="st">sigma2obs &lt;- sigma2p</span></span>
<span><span class="st">tauobs &lt;- 1/sigma2obs</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Process equation on the latent variable B(t)</span></span>
<span><span class="st"># Parameterized in term of P[t] = B[t] / K </span></span>
<span><span class="st"># to improve mixing (See Meyer and Millar 1999)</span></span>
<span><span class="st"># ---------------------------------------------------</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Biomass first year (Mean biomass = K)</span></span>
<span><span class="st">Pm[1] &lt;- alpha</span></span>
<span><span class="st"></span></span>
<span><span class="st">for (t in 1:((N)-1))</span></span>
<span><span class="st">{</span></span>
<span><span class="st">Pm[t+1] &lt;-</span></span>
<span><span class="st"># Logistic (Schaefer form)</span></span>
<span><span class="st">   max( (P[t] + r*P[t]*(1 - P[t]) - C[t]/K ), eps)</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Process error</span></span>
<span><span class="st"></span></span>
<span><span class="st">for (t in 1:(N))</span></span>
<span><span class="st">{</span></span>
<span><span class="st">logPm[t] &lt;- log(Pm[t]) </span></span>
<span><span class="st">P[t] ~ dlnorm(logPm[t],taup)</span></span>
<span><span class="st">} </span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Biomass</span></span>
<span><span class="st"></span></span>
<span><span class="st">for (t in 1:(N))  {  </span></span>
<span><span class="st">  B[t] &lt;- P[t]*K  </span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Observation equation</span></span>
<span><span class="st"># (abundance indices are available up to N)</span></span>
<span><span class="st"># ---------------------------------------------------</span></span>
<span><span class="st"></span></span>
<span><span class="st">for (t in 1:N) </span></span>
<span><span class="st">{</span></span>
<span><span class="st">Im[t] &lt;- q*B[t]</span></span>
<span><span class="st">logIm[t] &lt;- log(Im[t])</span></span>
<span><span class="st">I[t] ~ dlnorm(logIm[t],tauobs)</span></span>
<span><span class="st">} </span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Predicted abundance indices</span></span>
<span><span class="st"># (to check the fit osf the model to the data)</span></span>
<span><span class="st"># ---------------------------------------------------</span></span>
<span><span class="st"></span></span>
<span><span class="st">for (t in 1:N) </span></span>
<span><span class="st">{</span></span>
<span><span class="st">logIm_pred[t] &lt;- log(q*B[t])</span></span>
<span><span class="st">I_pred[t] ~ dlnorm(logIm_pred[t],tauobs)</span></span>
<span><span class="st">} </span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st">} # End model"</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">biomprod_jags_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">biomprod_jags_model_str</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">BioprodNamibianHake</span>,</span>
<span>                    n.chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(biomprod_jags_model_str), data =</span></span>
<span><span class="co">#&gt; BioprodNamibianHake, : Unused variable "Year" in data</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 24</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 57</span></span>
<span><span class="co">#&gt;    Total graph size: 362</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span><span class="va">t1j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Inferences</span></span>
<span><span class="va">t2j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">biomprod_jags_model</span>, n.iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">t3j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t4j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">posterior_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.samples.html" class="external-link">jags.samples</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">biomprod_jags_model</span>,</span>
<span>  variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r"</span>, <span class="st">"q"</span>, <span class="st">"sigma2p"</span>, <span class="st">"B"</span>,  <span class="st">"I_pred"</span><span class="op">)</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">9e4</span>,</span>
<span>                       thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">t5j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">q</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">sigma2p</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"q"</span>, <span class="st">"r"</span>, <span class="st">"sig"</span> <span class="op">)</span></span>
<span><span class="va">shinystan.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># retrieve effective sample size (ESS)</span></span>
<span><span class="op">(</span> <span class="va">ESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/retrieve.html" class="external-link">retrieve</a></span><span class="op">(</span> <span class="va">shinystan.obj</span>, <span class="st">"ess"</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;         q         r       sig </span></span>
<span><span class="co">#&gt;  47.54543  53.47569 285.66791</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t0j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         q         r       sig </span></span>
<span><span class="co">#&gt;  3.037718  3.416607 18.251565</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t2j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         q         r       sig </span></span>
<span><span class="co">#&gt;  3.076555  3.460289 18.484912</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t4j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         q         r       sig </span></span>
<span><span class="co">#&gt;  3.406856  3.831787 20.469462</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">shinystan.obj.stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span><span class="va">fit_hier</span><span class="op">)</span></span>
<span><span class="co"># retrieve effective sample size (ESS)</span></span>
<span><span class="op">(</span> <span class="va">ESS.stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/retrieve.html" class="external-link">retrieve</a></span><span class="op">(</span> <span class="va">shinystan.obj.stan</span>, <span class="st">"ess"</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r"</span>, <span class="st">"q"</span>, <span class="st">"sig"</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        r        q      sig </span></span>
<span><span class="co">#&gt; 11586.61 12047.54 12688.01</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3</span>, <span class="va">t0</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        r        q      sig </span></span>
<span><span class="co">#&gt; 43.87529 45.62071 48.04597</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3</span>, <span class="va">t2</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        r        q      sig </span></span>
<span><span class="co">#&gt; 54.15426 56.30860 59.30204</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">fit_hier</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt;        r        q      sig </span></span>
<span><span class="co">#&gt; 62.30331 64.78183 68.22572</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="stock-recruitment-models">Stock-Recruitment models<a class="anchor" aria-label="anchor" href="#stock-recruitment-models"></a>
</h2>
<div class="section level3">
<h3 id="independent-model">Independent model<a class="anchor" aria-label="anchor" href="#independent-model"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hsr_model_indep_S_gamma_stan</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">data {</span></span>
<span><span class="st">  int n_riv; // Number of rivers</span></span>
<span><span class="st">  int n_obs[n_riv]; // Number of observations by rivers</span></span>
<span><span class="st">  int n; // Total number of observations</span></span>
<span><span class="st">  int riv[n]; // River membership (indices k)</span></span>
<span><span class="st">  vector[n] S; // Stock data</span></span>
<span><span class="st">  vector[n] R; // Recruitment data</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">parameters {</span></span>
<span><span class="st">  vector&lt;lower=0, upper=200&gt;[n_riv] Sopt;</span></span>
<span><span class="st">  vector&lt;lower=0, upper=1&gt;[n_riv] hopt;</span></span>
<span><span class="st">  real&lt;lower=0&gt; tau;</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">transformed parameters {</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n_riv] alpha;</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n_riv] beta ;</span></span>
<span><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span><span class="st">  // real Copt;</span></span>
<span><span class="st">  // real Ropt;</span></span>
<span><span class="st">  vector[n] LogR;</span></span>
<span><span class="st">  // real Slope;</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  for (k in 1:n_riv) {</span></span>
<span><span class="st">    alpha[k] = exp(hopt[k])/(1-hopt[k]) ;  </span></span>
<span><span class="st">    beta[k] = hopt[k]/Sopt[k]     ;    </span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  sigma = tau^-0.5        ;  </span></span>
<span><span class="st">  // Copt = hopt*Sopt/(1-hopt);</span></span>
<span><span class="st">  // Ropt = Sopt + Copt;</span></span>
<span><span class="st">  // Slope = exp(alpha);</span></span>
<span><span class="st">  for (t in 1:n) {</span></span>
<span><span class="st">    LogR[t] = log(S[t]) + log(alpha[riv[t]]) - beta[riv[t]]*S[t] ;  // LogR[t] is the logarithm of the Ricker function  </span></span>
<span><span class="st">  }</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  tau ~ gamma(.001, .001) ; // Diffuse prior for the variance</span></span>
<span><span class="st">  for (k in 1:n_riv) {</span></span>
<span><span class="st">    hopt[k] ~ beta(1,1) ;   </span></span>
<span><span class="st">    Sopt[k] ~ gamma(1, 1./1600) ;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">// </span></span>
<span><span class="st">    log(R) ~ normal(LogR, sigma) ;</span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span><span class="st">"HSR_Ricker_LogN_Management_S_gamma"</span></span>
<span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_model.html" class="external-link">stan_model</a></span><span class="op">(</span>model_code <span class="op">=</span>  <span class="va">hsr_model_indep_S_gamma_stan</span>,</span>
<span>                 model_name <span class="op">=</span>  <span class="va">model_name</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running /usr/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; gcc -I"/usr/share/R/include" -DNDEBUG   -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/Rcpp/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/unsupported"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/BH/include" -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/src/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppParallel/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include '/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1      -fpic  -g -O2 -fdebug-prefix-map=/build/r-base-kt0bjq/r-base-4.2.0=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:88,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name ‘namespace’</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       | ^~~~~~~~~</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:17: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘{’ token</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       |                 ^</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:96:10: fatal error: complex: No such file or directory</span></span>
<span><span class="co">#&gt;    96 | #include &lt;complex&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/usr/lib/R/etc/Makeconf:168: foo.o] Error 1</span></span>
<span><span class="va">t1s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># Number iteration for the "warm up" phase</span></span>
<span><span class="va">n_warm</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="co"># Number iteration for inferences</span></span>
<span><span class="va">n_iter</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">n_thin</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Number of chains</span></span>
<span><span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">params</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sopt"</span>,<span class="st">"hopt"</span>,<span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co"># Inferences</span></span>
<span></span>
<span><span class="va">t2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sm</span>,</span>
<span>                data <span class="op">=</span> <span class="va">SRSalmon</span>, </span>
<span>                pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sopt"</span>,<span class="st">"hopt"</span>,<span class="st">"tau"</span><span class="op">)</span>, <span class="co">#params,</span></span>
<span>                chains <span class="op">=</span> <span class="va">n_chains</span>, </span>
<span>                iter <span class="op">=</span> <span class="va">n_iter</span>, </span>
<span>                warmup <span class="op">=</span> <span class="va">n_warm</span>, </span>
<span>                thin <span class="op">=</span> <span class="va">n_thin</span> <span class="co"># Acceptance rate up from .8 to remove some divergent transitions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'HSR_Ricker_LogN_Management_S_gamma' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 9e-05 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.9 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:     1 / 100000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10000 / 100000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10001 / 100000 [ 10%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 20000 / 100000 [ 20%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 30000 / 100000 [ 30%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 40000 / 100000 [ 40%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 50000 / 100000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 60000 / 100000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 70000 / 100000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 80000 / 100000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 90000 / 100000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100000 / 100000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 26.1548 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                236.518 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                262.673 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 74 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="va">t3s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stan_indfit_sso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">ESS.stan</span> <span class="op">&lt;-</span> <span class="va">stan_indfit_sso</span><span class="op">@</span><span class="va">summary</span><span class="op">[</span><span class="op">-</span><span class="fl">28</span>, <span class="st">"n_eff"</span><span class="op">]</span></span>
<span><span class="co">#( ESS.stan &lt;- retrieve( stan_indfit_sso, "ess", pars = c("Sopt", "hopt", "tau") ))</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt; 138.30318 187.17572  19.41692  71.93286 187.45645 322.18254 100.25301  14.43650 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt;  20.81566  79.56363 293.32434 341.03405 185.04734 194.14325 227.88742  22.45126 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  38.93979 105.17149 159.31087  68.96726  20.99317  88.55028  63.02583 201.55371 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt; 301.11577 179.38035  50.43444</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3s</span>, <span class="va">t2s</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt; 121.46568 164.38831  17.05304  63.17551 164.63487 282.95894  88.04786  12.67895 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt;  18.28149  69.87729 257.61404 299.51540 162.51904 170.50759 200.14363  19.71797 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  34.19913  92.36756 139.91582  60.57095  18.43739  77.76986  55.35285 177.01587 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt; 264.45691 157.54197  44.29438</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3s</span>, <span class="va">t0s</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt;  99.01853 134.00895  13.90159  51.50052 134.20994 230.66744  71.77641  10.33585 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt;  14.90302  56.96379 210.00634 244.16423 132.48513 138.99738 163.15660  16.07404 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  27.87905  75.29781 114.05904  49.37729  15.03011  63.39780  45.12351 144.30291 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt; 215.58463 128.42783  36.10867</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_stockrec_model</span> <span class="op">&lt;-</span> <span class="st">"model</span></span>
<span><span class="st">{</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Prior </span></span>
<span><span class="st"></span></span>
<span><span class="st"># Precision of the recruitment process</span></span>
<span><span class="st"># Very small values of parameters</span></span>
<span><span class="st"></span></span>
<span><span class="st">    tau ~ dgamma(0.001,0.001)</span></span>
<span><span class="st">    sigma &lt;- sqrt(1/tau)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Gamma distribution for Sst</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    E.Sst &lt;- 40 </span></span>
<span><span class="st">    CV.Sst &lt;- 1 </span></span>
<span><span class="st">    a &lt;- 1/(CV.Sst*CV.Sst)</span></span>
<span><span class="st">    b &lt;- (1/(CV.Sst*CV.Sst))*(1/E.Sst)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Priors for the n.riv rivers</span></span>
<span><span class="st"></span></span>
<span><span class="st">for( r in 1 : n_riv )</span></span>
<span><span class="st">{</span></span>
<span><span class="st"></span></span>
<span><span class="st"># dummy</span></span>
<span><span class="st">    n_obs_riv[r] &lt;- n_obs[r]</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Beta distribution for hst </span></span>
<span><span class="st">    hst[r] ~ dbeta(1, 1)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Gamma distribution for Sst</span></span>
<span><span class="st">    # Sst[r] ~ dunif(1,200)</span></span>
<span><span class="st">    Sst[r] ~ dgamma(a,b)I(,200)</span></span>
<span><span class="st"></span></span>
<span><span class="st">}  # end loop on rivers (priors)</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Likelihood</span></span>
<span><span class="st"># Recruitment process</span></span>
<span><span class="st"># Ricker equation with lognormal process errors</span></span>
<span><span class="st"># Management parameters (Schnute and Kronlund, 1996. CJFAS, 53:1281-1293)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Mean R with parameterization (hst,Sst)</span></span>
<span><span class="st"># Sst = stock at MSY    </span></span>
<span><span class="st"># Cst = MSY</span></span>
<span><span class="st"># Ropt = recruitment at MSY</span></span>
<span><span class="st"># hst  = exploitation rate at MSY = Cst/Ropt</span></span>
<span><span class="st"># tau = precision of process errors (1/variance)</span></span>
<span><span class="st"></span></span>
<span><span class="st">for( i in 1 : n )</span></span>
<span><span class="st">{</span></span>
<span><span class="st"></span></span>
<span><span class="st">log.R[i] &lt;-  log(S[i]) + hst[riv[i]] - log(1-hst[riv[i]]) - (hst[riv[i]]/Sst[riv[i]]) *S[i]</span></span>
<span><span class="st">R[i] ~ dlnorm(log.R[i], tau)</span></span>
<span><span class="st">}  # end loop on years</span></span>
<span><span class="st"></span></span>
<span><span class="st">}  # end model"</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ind_stockrec_jags_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">ind_stockrec_model</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">SRSalmon</span>,</span>
<span>                    n.chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "name_riv" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "country_riv" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "area" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "lat" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "lat_pred" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(ind_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "n_pred" in data</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 139</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 27</span></span>
<span><span class="co">#&gt;    Total graph size: 1201</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span><span class="va">t1j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Inferences</span></span>
<span><span class="va">t2j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ind_stockrec_jags_model</span>, n.iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">t3j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t4j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">posterior_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.samples.html" class="external-link">jags.samples</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">ind_stockrec_jags_model</span>,</span>
<span>  variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hst"</span>, <span class="st">"Sst"</span>, <span class="st">"tau"</span><span class="op">)</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">9e4</span>,</span>
<span>                       thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">t5j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarise_draws(as_draws_df(posterior_sample),</span></span>
<span><span class="co">#                 default_convergence_measures()) %&gt;% </span></span>
<span><span class="co">#   filter(variable %in% c("r", "q", "sigma2p"))</span></span>
<span></span>
<span><span class="co"># posterior_sample$q[1,,1]</span></span>
<span></span>
<span><span class="co"># create shinystan object</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">hst</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">13</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">Sst</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">13</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#dfw &lt;- extract_wider(posterior_sample)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"hopt."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sopt."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">shinystan.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># retrieve effective sample size (ESS)</span></span>
<span><span class="op">(</span> <span class="va">ESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/retrieve.html" class="external-link">retrieve</a></span><span class="op">(</span> <span class="va">shinystan.obj</span>, <span class="st">"ess"</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;       tau    hopt.1    hopt.2    hopt.3    hopt.4    hopt.5    hopt.6    hopt.7 </span></span>
<span><span class="co">#&gt;  1502.169 62812.785 58994.136 59709.510 58473.681 59716.744 59585.629 59063.936 </span></span>
<span><span class="co">#&gt;    hopt.8    hopt.9   hopt.10   hopt.11   hopt.12   hopt.13    Sopt.1    Sopt.2 </span></span>
<span><span class="co">#&gt; 59770.239 58481.746 59105.621 58995.147 59560.268 58443.230 70592.677 68094.031 </span></span>
<span><span class="co">#&gt;    Sopt.3    Sopt.4    Sopt.5    Sopt.6    Sopt.7    Sopt.8    Sopt.9   Sopt.10 </span></span>
<span><span class="co">#&gt; 69952.674 69650.722 72603.831 69967.584 68649.636 69885.277 69275.679 69923.113 </span></span>
<span><span class="co">#&gt;   Sopt.11   Sopt.12   Sopt.13 </span></span>
<span><span class="co">#&gt; 69945.787 68835.625 68266.387</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t0j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        tau     hopt.1     hopt.2     hopt.3     hopt.4     hopt.5     hopt.6 </span></span>
<span><span class="co">#&gt;   85.63412 3580.76806 3363.07835 3403.85970 3333.40878 3404.27208 3396.79760 </span></span>
<span><span class="co">#&gt;     hopt.7     hopt.8     hopt.9    hopt.10    hopt.11    hopt.12    hopt.13 </span></span>
<span><span class="co">#&gt; 3367.05747 3407.32168 3333.86855 3369.43380 3363.13596 3395.35186 3331.67285 </span></span>
<span><span class="co">#&gt;     Sopt.1     Sopt.2     Sopt.3     Sopt.4     Sopt.5     Sopt.6     Sopt.7 </span></span>
<span><span class="co">#&gt; 4024.27630 3881.83601 3987.79163 3970.57831 4138.92617 3988.64166 3913.50938 </span></span>
<span><span class="co">#&gt;     Sopt.8     Sopt.9    Sopt.10    Sopt.11    Sopt.12    Sopt.13 </span></span>
<span><span class="co">#&gt; 3983.94954 3949.19823 3986.10650 3987.39903 3924.11204 3891.66153</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t2j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        tau     hopt.1     hopt.2     hopt.3     hopt.4     hopt.5     hopt.6 </span></span>
<span><span class="co">#&gt;   86.58344 3620.46370 3400.36073 3441.59418 3370.36225 3442.01113 3434.45379 </span></span>
<span><span class="co">#&gt;     hopt.7     hopt.8     hopt.9    hopt.10    hopt.11    hopt.12    hopt.13 </span></span>
<span><span class="co">#&gt; 3404.38396 3445.09453 3370.82712 3406.78664 3400.41898 3432.99202 3368.60708 </span></span>
<span><span class="co">#&gt;     Sopt.1     Sopt.2     Sopt.3     Sopt.4     Sopt.5     Sopt.6     Sopt.7 </span></span>
<span><span class="co">#&gt; 4068.88859 3924.86923 4031.99946 4014.59531 4184.80945 4032.85891 3956.89373 </span></span>
<span><span class="co">#&gt;     Sopt.8     Sopt.9    Sopt.10    Sopt.11    Sopt.12    Sopt.13 </span></span>
<span><span class="co">#&gt; 4028.11477 3992.97821 4030.29565 4031.60250 3967.61393 3934.80367</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t4j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        tau     hopt.1     hopt.2     hopt.3     hopt.4     hopt.5     hopt.6 </span></span>
<span><span class="co">#&gt;   96.12736 4019.54040 3775.17590 3820.95443 3741.87075 3821.41735 3813.02698 </span></span>
<span><span class="co">#&gt;     hopt.7     hopt.8     hopt.9    hopt.10    hopt.11    hopt.12    hopt.13 </span></span>
<span><span class="co">#&gt; 3779.64261 3824.84062 3742.38685 3782.31012 3775.24057 3811.40408 3739.92210 </span></span>
<span><span class="co">#&gt;     Sopt.1     Sopt.2     Sopt.3     Sopt.4     Sopt.5     Sopt.6     Sopt.7 </span></span>
<span><span class="co">#&gt; 4517.39428 4357.49996 4476.43894 4457.11637 4646.09288 4477.39313 4393.05445 </span></span>
<span><span class="co">#&gt;     Sopt.8     Sopt.9    Sopt.10    Sopt.11    Sopt.12    Sopt.13 </span></span>
<span><span class="co">#&gt; 4472.12605 4433.11646 4474.54732 4475.99822 4404.95632 4368.52945</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hierarchical-model-with-latitude-covariates">Hierarchical model with latitude covariates<a class="anchor" aria-label="anchor" href="#hierarchical-model-with-latitude-covariates"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hsr_model_hier_S_gamma_stan</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">data {</span></span>
<span><span class="st">  int n_riv; // Number of rivers</span></span>
<span><span class="st">  int n_obs[n_riv]; // Number of observations by rivers</span></span>
<span><span class="st">  int n; // Total number of observations</span></span>
<span><span class="st">  int riv[n]; // River membership (indices k)</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n] S; // Stock data</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n] R; // Recruitment data</span></span>
<span><span class="st">  vector[n_riv] lat; //Latitude of rivers</span></span>
<span><span class="st">  int n_pred;</span></span>
<span><span class="st">  vector[n_pred] lat_pred;</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">transformed data {</span></span>
<span><span class="st">  vector[n_riv] lat_rescaled;</span></span>
<span><span class="st">  lat_rescaled = lat-mean(lat);</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">parameters {</span></span>
<span><span class="st">  real&lt;lower=0&gt; tau;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  real&lt;lower=0, upper=20&gt; CV_S;</span></span>
<span><span class="st">  real&lt;lower=-5, upper=5&gt; alpha;</span></span>
<span><span class="st">  real&lt;lower=-50, upper=50&gt; beta;</span></span>
<span><span class="st">  vector&lt;lower=0, upper=200&gt;[n_riv] Sopt;  </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  </span></span>
<span><span class="st">  real&lt;lower=-5, upper=5&gt; delta;</span></span>
<span><span class="st">  real&lt;lower=-50, upper=50&gt; kappa;</span></span>
<span><span class="st">  real&lt;lower=0&gt; tau_h;</span></span>
<span><span class="st">  vector[n_riv] logit_h;</span></span>
<span><span class="st"></span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">transformed parameters {</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  real&lt;lower=0&gt; sigma;      // stdev for lognormal noise</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n_riv] mu_S; // Expected mean of Sopt  </span></span>
<span><span class="st">  real&lt;lower=0&gt; a; // parameters of the gamma prior of Sopt</span></span>
<span><span class="st">  vector&lt;lower=0&gt;[n_riv] b; // parameters of the gamma prior of Sopt</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  real&lt;lower=0&gt; sigma_h; // stdev for logit of h </span></span>
<span><span class="st">  vector[n_riv] logit_mu_h; // logit of the expected mean of hopt</span></span>
<span><span class="st">  vector&lt;lower=0, upper=1&gt;[n_riv] hopt; </span></span>
<span><span class="st">  vector[n] LogR;</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  </span></span>
<span><span class="st"></span></span>
<span><span class="st">  sigma = tau^-0.5  ;</span></span>
<span><span class="st">  sigma_h = tau_h^-0.5 ;</span></span>
<span><span class="st"></span></span>
<span><span class="st">  for (k in 1:n_riv) {</span></span>
<span><span class="st">    mu_S[k] = exp(alpha * (lat[k]) + beta) ;</span></span>
<span><span class="st">    logit_mu_h[k] = delta * (lat[k]) + kappa ;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  a = 1/square(CV_S) ;</span></span>
<span><span class="st">  for (k in 1:n_riv) {</span></span>
<span><span class="st">    b[k] = 1/(mu_S[k]*square(CV_S)) ;</span></span>
<span><span class="st">  }  </span></span>
<span><span class="st">  hopt = inv_logit(logit_h) ;</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st">  for (t in 1:n) {</span></span>
<span><span class="st">    LogR[t] = hopt[riv[t]] + log(S[t]) - log(1 - hopt[riv[t]]) - hopt[riv[t]]/Sopt[riv[t]]*S[t] ;  // LogR[t] is the logarithm of the Ricker function  </span></span>
<span><span class="st">  }</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  tau ~ gamma(.001, .001) ; // Diffuse prior for the precision</span></span>
<span><span class="st">  tau_h ~ gamma(.001, .001) ; // Diffuse prior for the precision</span></span>
<span><span class="st"></span></span>
<span><span class="st">  for (k in 1:n_riv) {</span></span>
<span><span class="st">    logit_h[k] ~ normal(logit_mu_h[k], sigma_h);</span></span>
<span><span class="st">    Sopt[k] ~ gamma(a, b[k]) ; // T[0,200] ;</span></span>
<span><span class="st">  }</span></span>
<span><span class="st"></span></span>
<span><span class="st">  </span></span>
<span><span class="st">  log(R) ~ normal(LogR, sigma) ;</span></span>
<span><span class="st">}</span></span>
<span><span class="st"></span></span>
<span><span class="st">"</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hier_stockrec_model</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">model</span></span>
<span><span class="st">{</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Prior </span></span>
<span><span class="st"></span></span>
<span><span class="st"># Precision of the recruitment process</span></span>
<span><span class="st"># Gamma distribution with very small parameters</span></span>
<span><span class="st"></span></span>
<span><span class="st">    tau ~ dgamma(0.001,0.001)</span></span>
<span><span class="st">    sigma &lt;- sqrt(1/tau)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Prior for the regression with latitude</span></span>
<span><span class="st">    </span></span>
<span><span class="st"># Prior for the parameters of the regression on Sst = f(Latitude)</span></span>
<span><span class="st">    alpha ~ dunif(-5, 5)</span></span>
<span><span class="st">    B2 ~ dunif(-50, 50)</span></span>
<span><span class="st">    beta &lt;- B2 - alpha*mean(lat[])</span></span>
<span><span class="st">    CV.Sst ~ dunif(0,20)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Prior for the parameters of the regression on h = f(Latitude)</span></span>
<span><span class="st">    delta ~ dunif(-5, 5)</span></span>
<span><span class="st">    D2 ~ dunif(-50, 50)</span></span>
<span><span class="st">    kappa &lt;- D2 - delta*mean(lat[])</span></span>
<span><span class="st">    tau.h ~ dgamma(0.001,0.001)</span></span>
<span><span class="st">    sigma.h &lt;- sqrt(1/tau.h)</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Priors for the n.riv rivers</span></span>
<span><span class="st">    </span></span>
<span><span class="st">for( r in 1 : n_riv )</span></span>
<span><span class="st">{</span></span>
<span><span class="st"></span></span>
<span><span class="st"># dummy</span></span>
<span><span class="st">    n_obs_riv[r] &lt;- n_obs[r]</span></span>
<span><span class="st"></span></span>
<span><span class="st"># Sst (hierarchical)</span></span>
<span><span class="st">    log.ESst[r] &lt;- alpha * (lat[r]-mean(lat[])) + B2 </span></span>
<span><span class="st">    ESst[r] &lt;- exp(log.ESst[r])</span></span>
<span><span class="st">    a[r] &lt;- 1/(CV.Sst*CV.Sst)</span></span>
<span><span class="st">    b[r] &lt;- (1/(CV.Sst*CV.Sst))*(1/ESst[r])</span></span>
<span><span class="st">    Sst[r] ~ dgamma(a[r],b[r])T(,200)</span></span>
<span><span class="st">    </span></span>
<span><span class="st"># hst (hierarchical)</span></span>
<span><span class="st">    logitEhst[r] &lt;- delta * (lat[r]-mean(lat[])) + D2 </span></span>
<span><span class="st">    logit(hst[r]) &lt;- logithst[r] </span></span>
<span><span class="st">    logithst[r] ~ dnorm(logitEhst[r],tau.h)</span></span>
<span><span class="st"></span></span>
<span><span class="st">} # end loop on rivers (priors)</span></span>
<span><span class="st"></span></span>
<span><span class="st"></span></span>
<span><span class="st"># Likelihood</span></span>
<span><span class="st"># Recruitment process</span></span>
<span><span class="st"># Ricker equation with lognormal process errors</span></span>
<span><span class="st"></span></span>
<span><span class="st">for( i in 1 : n )</span></span>
<span><span class="st">{</span></span>
<span><span class="st">log.R[i] &lt;-  log(S[i]) + hst[riv[i]] - log(1-hst[riv[i]]) - (hst[riv[i]]/Sst[riv[i]]) *S[i]</span></span>
<span><span class="st">R[i] ~ dlnorm(log.R[i], tau)</span></span>
<span><span class="st">}</span></span>
<span><span class="st">        </span></span>
<span><span class="st">}  # end model"</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span><span class="st">"hierarchical-stock-recruitment"</span></span>
<span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_model.html" class="external-link">stan_model</a></span><span class="op">(</span>model_code <span class="op">=</span>  <span class="va">hsr_model_hier_S_gamma_stan</span>,</span>
<span>                 model_name <span class="op">=</span>  <span class="va">model_name</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running /usr/lib/R/bin/R CMD SHLIB foo.c</span></span>
<span><span class="co">#&gt; gcc -I"/usr/share/R/include" -DNDEBUG   -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/Rcpp/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/unsupported"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/BH/include" -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/src/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppParallel/include/"  -I"/home/stc/R/x86_64-pc-linux-gnu-library/4.2/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include '/home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1      -fpic  -g -O2 -fdebug-prefix-map=/build/r-base-kt0bjq/r-base-4.2.0=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2  -c foo.c -o foo.o</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:88,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name ‘namespace’</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       | ^~~~~~~~~</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:17: error: expected ‘=’, ‘,’, ‘;’, ‘asm’ or ‘__attribute__’ before ‘{’ token</span></span>
<span><span class="co">#&gt;   628 | namespace Eigen {</span></span>
<span><span class="co">#&gt;       |                 ^</span></span>
<span><span class="co">#&gt; In file included from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Dense:1,</span></span>
<span><span class="co">#&gt;                  from /home/stc/R/x86_64-pc-linux-gnu-library/4.2/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13,</span></span>
<span><span class="co">#&gt;                  from &lt;command-line&gt;:</span></span>
<span><span class="co">#&gt; /home/stc/R/x86_64-pc-linux-gnu-library/4.2/RcppEigen/include/Eigen/Core:96:10: fatal error: complex: No such file or directory</span></span>
<span><span class="co">#&gt;    96 | #include &lt;complex&gt;</span></span>
<span><span class="co">#&gt;       |          ^~~~~~~~~</span></span>
<span><span class="co">#&gt; compilation terminated.</span></span>
<span><span class="co">#&gt; make: *** [/usr/lib/R/etc/Makeconf:168: foo.o] Error 1</span></span>
<span><span class="va">t1s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="co"># Number iteration for the "warm up" phase</span></span>
<span><span class="va">n_warm</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="co"># Number iteration for inferences</span></span>
<span><span class="va">n_iter</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">n_thin</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Number of chains</span></span>
<span><span class="va">n_chains</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">params</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sopt"</span>,<span class="st">"hopt"</span>,<span class="st">"tau"</span><span class="op">)</span></span>
<span><span class="co"># Inferences</span></span>
<span></span>
<span><span class="va">t2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sm</span>,</span>
<span>                data <span class="op">=</span> <span class="va">SRSalmon</span>, </span>
<span>                pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sopt"</span>,<span class="st">"hopt"</span>,<span class="st">"tau"</span><span class="op">)</span>, <span class="co">#params,</span></span>
<span>                chains <span class="op">=</span> <span class="va">n_chains</span>, </span>
<span>                iter <span class="op">=</span> <span class="va">n_iter</span>, </span>
<span>                warmup <span class="op">=</span> <span class="va">n_warm</span>, </span>
<span>                thin <span class="op">=</span> <span class="va">n_thin</span> <span class="co"># Acceptance rate up from .8 to remove some divergent transitions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'hierarchical-stock-recruitment' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000153 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.53 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:     1 / 100000 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10000 / 100000 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 10001 / 100000 [ 10%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 20000 / 100000 [ 20%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 30000 / 100000 [ 30%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 40000 / 100000 [ 40%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 50000 / 100000 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 60000 / 100000 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 70000 / 100000 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 80000 / 100000 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 90000 / 100000 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100000 / 100000 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 46.4114 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                476.38 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                522.791 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 293 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 2 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="va">t3s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stan_hierfit_sso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">ESS.stan</span> <span class="op">&lt;-</span> <span class="va">stan_hierfit_sso</span><span class="op">@</span><span class="va">summary</span><span class="op">[</span><span class="op">-</span><span class="fl">28</span>, <span class="st">"n_eff"</span><span class="op">]</span></span>
<span><span class="co">#( ESS.stan &lt;- retrieve( stan_hierfit_sso, "ess", pars = c("Sopt", "hopt", "tau") ))</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-class.html" class="external-link">get_elapsed_time</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt;  73.23786  88.12714 115.66648  62.73525  76.48700 103.58549  76.85342  24.49288 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt; 109.92816  40.45879  67.47631  69.41879  45.12748  94.66577  92.64550 131.53125 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  92.96036 111.16187 115.34748 110.75187  56.00697 121.69635  89.33267  90.83439 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt;  99.00893  73.73821 128.52543</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3s</span>, <span class="va">t2s</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt;  66.09819  79.53598 104.39062  56.61944  69.03059  93.48735  69.36129  22.10517 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt;  99.21170  36.51463  60.89831  62.65143  40.72819  85.43718  83.61386 118.70879 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  83.89802 100.32514 104.10271  99.95511  50.54707 109.83266  80.62398  81.97931 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt;  89.35694  66.54977 115.99600</span></span>
<span><span class="va">ESS.stan</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t3s</span>, <span class="va">t0s</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sopt[1]   Sopt[2]   Sopt[3]   Sopt[4]   Sopt[5]   Sopt[6]   Sopt[7]   Sopt[8] </span></span>
<span><span class="co">#&gt;  58.67981  70.60943  92.67457  50.26489  61.28309  82.99501  61.57668  19.62424 </span></span>
<span><span class="co">#&gt;   Sopt[9]  Sopt[10]  Sopt[11]  Sopt[12]  Sopt[13]   hopt[1]   hopt[2]   hopt[3] </span></span>
<span><span class="co">#&gt;  88.07690  32.41649  54.06352  55.61988  36.15715  75.84832  74.22964 105.38577 </span></span>
<span><span class="co">#&gt;   hopt[4]   hopt[5]   hopt[6]   hopt[7]   hopt[8]   hopt[9]  hopt[10]  hopt[11] </span></span>
<span><span class="co">#&gt;  74.48191  89.06537  92.41897  88.73687  44.87403  97.50583  71.57533  72.77854 </span></span>
<span><span class="co">#&gt;  hopt[12]  hopt[13]       tau </span></span>
<span><span class="co">#&gt;  79.32816  59.08070 102.97744</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hier_stockrec_jags_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">hier_stockrec_model</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">SRSalmon</span>,</span>
<span>                    n.chains <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(hier_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "name_riv" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(hier_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "country_riv" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(hier_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "area" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(hier_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "lat_pred" in data</span></span>
<span><span class="co">#&gt; Warning in jags.model(file = textConnection(hier_stockrec_model), data =</span></span>
<span><span class="co">#&gt; SRSalmon, : Unused variable "n_pred" in data</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 139</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 33</span></span>
<span><span class="co">#&gt;    Total graph size: 1324</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span><span class="va">t1j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Inferences</span></span>
<span><span class="va">t2j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">hier_stockrec_jags_model</span>, n.iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">t3j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t4j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">posterior_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.samples.html" class="external-link">jags.samples</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">hier_stockrec_jags_model</span>,</span>
<span>  variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hst"</span>, <span class="st">"Sst"</span>, <span class="st">"tau"</span><span class="op">)</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">9e4</span>,</span>
<span>                       thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">t5j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">tau</span><span class="op">[</span><span class="fl">1</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">1</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">hst</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">13</span> <span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span> <span class="va">posterior_sample</span><span class="op">$</span><span class="va">Sst</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>,,<span class="fl">1</span><span class="op">]</span>, ncol<span class="op">=</span><span class="fl">13</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"hopt."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sopt."</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">shinystan.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/as.shinystan.html" class="external-link">as.shinystan</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="va">samples</span> <span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="op">(</span> <span class="va">ESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/retrieve.html" class="external-link">retrieve</a></span><span class="op">(</span> <span class="va">shinystan.obj</span>, <span class="st">"ess"</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;      tau   hopt.1   hopt.2   hopt.3   hopt.4   hopt.5   hopt.6   hopt.7 </span></span>
<span><span class="co">#&gt; 15259.25 55018.07 55137.27 53546.05 54323.53 55154.15 54272.71 54326.99 </span></span>
<span><span class="co">#&gt;   hopt.8   hopt.9  hopt.10  hopt.11  hopt.12  hopt.13   Sopt.1   Sopt.2 </span></span>
<span><span class="co">#&gt; 54389.89 53889.59 54179.98 53406.77 55803.82 55415.64 63386.39 65069.16 </span></span>
<span><span class="co">#&gt;   Sopt.3   Sopt.4   Sopt.5   Sopt.6   Sopt.7   Sopt.8   Sopt.9  Sopt.10 </span></span>
<span><span class="co">#&gt; 65438.86 64002.31 65474.22 63821.44 65408.22 63000.14 62942.17 64530.84 </span></span>
<span><span class="co">#&gt;  Sopt.11  Sopt.12  Sopt.13 </span></span>
<span><span class="co">#&gt; 65756.91 64832.54 65775.37</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t0j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       tau    hopt.1    hopt.2    hopt.3    hopt.4    hopt.5    hopt.6    hopt.7 </span></span>
<span><span class="co">#&gt;  365.3069 1317.1340 1319.9877 1281.8939 1300.5068 1320.3917 1299.2901 1300.5895 </span></span>
<span><span class="co">#&gt;    hopt.8    hopt.9   hopt.10   hopt.11   hopt.12   hopt.13    Sopt.1    Sopt.2 </span></span>
<span><span class="co">#&gt; 1302.0954 1290.1181 1297.0702 1278.5594 1335.9450 1326.6519 1517.4718 1557.7574 </span></span>
<span><span class="co">#&gt;    Sopt.3    Sopt.4    Sopt.5    Sopt.6    Sopt.7    Sopt.8    Sopt.9   Sopt.10 </span></span>
<span><span class="co">#&gt; 1566.6080 1532.2171 1567.4545 1527.8868 1565.8744 1508.2250 1506.8372 1544.8700 </span></span>
<span><span class="co">#&gt;   Sopt.11   Sopt.12   Sopt.13 </span></span>
<span><span class="co">#&gt; 1574.2221 1552.0926 1574.6641</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t2j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       tau    hopt.1    hopt.2    hopt.3    hopt.4    hopt.5    hopt.6    hopt.7 </span></span>
<span><span class="co">#&gt;  369.7034 1332.9855 1335.8735 1297.3213 1316.1583 1336.2824 1314.9269 1316.2419 </span></span>
<span><span class="co">#&gt;    hopt.8    hopt.9   hopt.10   hopt.11   hopt.12   hopt.13    Sopt.1    Sopt.2 </span></span>
<span><span class="co">#&gt; 1317.7659 1305.6445 1312.6803 1293.9467 1352.0229 1342.6179 1535.7344 1576.5048 </span></span>
<span><span class="co">#&gt;    Sopt.3    Sopt.4    Sopt.5    Sopt.6    Sopt.7    Sopt.8    Sopt.9   Sopt.10 </span></span>
<span><span class="co">#&gt; 1585.4619 1550.6571 1586.3186 1546.2747 1584.7195 1526.3762 1524.9718 1563.4623 </span></span>
<span><span class="co">#&gt;   Sopt.11   Sopt.12   Sopt.13 </span></span>
<span><span class="co">#&gt; 1593.1677 1570.7718 1593.6150</span></span>
<span><span class="va">ESS</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="va">t5j</span>, <span class="va">t4j</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       tau    hopt.1    hopt.2    hopt.3    hopt.4    hopt.5    hopt.6    hopt.7 </span></span>
<span><span class="co">#&gt;  407.1919 1468.1526 1471.3334 1428.8720 1449.6190 1471.7838 1448.2628 1449.7112 </span></span>
<span><span class="co">#&gt;    hopt.8    hopt.9   hopt.10   hopt.11   hopt.12   hopt.13    Sopt.1    Sopt.2 </span></span>
<span><span class="co">#&gt; 1451.3897 1438.0392 1445.7884 1425.1551 1489.1204 1478.7617 1691.4605 1736.3652 </span></span>
<span><span class="co">#&gt;    Sopt.3    Sopt.4    Sopt.5    Sopt.6    Sopt.7    Sopt.8    Sopt.9   Sopt.10 </span></span>
<span><span class="co">#&gt; 1746.2305 1707.8964 1747.1740 1703.0697 1745.4128 1681.1535 1679.6066 1722.0001 </span></span>
<span><span class="co">#&gt;   Sopt.11   Sopt.12   Sopt.13 </span></span>
<span><span class="co">#&gt; 1754.7176 1730.0508 1755.2103</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Saint-Clair Chabert-Liddell, Éric Parent, Étienne Rivot.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
