<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hbm4ecology">
<title>Hierarchical Exchangeable Binomial Model for Capture-Mark-Recapture Data • hbm4ecology</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Exchangeable Binomial Model for Capture-Mark-Recapture Data">
<meta property="og:description" content="hbm4ecology">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hbm4ecology</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/hierarchical-exchangeable-cmr.html">Hierarchical Exchangeable Binomial Model for Capture-Mark-Recapture Data</a>
    <a class="dropdown-item" href="../articles/hierarchical-stock-recruitment.html">Hierarchical Stock Recruitment Analysis</a>
    <a class="dropdown-item" href="../articles/hierarchical-successive-removal.html">Hierarchical Successive Removal</a>
    <a class="dropdown-item" href="../articles/namibian-hake-biomass-production.html">Biomass Production Model: The Namibian Hake Fishery</a>
    <a class="dropdown-item" href="../articles/state-space-modeling-of-a-salmon-life-cycle-model.html">State-space Modeling of A. Salmon Life Cycle Model</a>
    <a class="dropdown-item" href="../articles/stan-jags-performance-comparaison-for-hbmforecology.html">Stan and Jags performance comparaison for Hierarchical Bayesian Modeling for Ecological Data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Hierarchical Exchangeable Binomial Model for Capture-Mark-Recapture Data</h1>
            <h3 data-toc-skip class="subtitle">Jags code for chapter
9.2</h3>
            
      
      
      <div class="d-none name"><code>hierarchical-exchangeable-cmr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hbm4ecology</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mcmc-jags.sourceforge.io" class="external-link">rjags</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span></code></pre></div>
<p>The main idea is to link the capture-mark-recapture (CMR) models for
yearly observations together by a hierarchical structure. In this case
study inspired by the article of <span class="citation">Rivot and
Prévost (<a href="#ref-RivotPrevost2002" role="doc-biblioref">2002</a>)</span>, the years are the statistical
units that look alike and that hypothesized resemblance allows for
transferring information from a given year to the other years.</p>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>Relatively long but sparse (small sample size) series of data are
quite common when dealing with CMR surveys aimed at estimating the
abundance of wild populations over a series of years. For instance on
the Oir River, the rangers from the French National Research Institute
for Agronomy (INRA) and from the National Office of Water Management
(ONEMA) have collected CMR data about adult salmon that swam back to
spawn in the Oir River for the years 1984–2000.</p>
<center>
<div class="figure">
<img src="figures/CmrOir/AdultMarkRecapture.png" style="width:80.0%;height:80.0%" alt=""><p class="caption">Figure 1 – Marking a spawner entering the Scorff
River</p>
</div>
</center>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"CmrOir"</span><span class="op">)</span></span>
<span><span class="va">CmrOir</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fl">1984</span><span class="op">:</span><span class="fl">2000</span>, .before<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Year</th>
<th align="right">y1</th>
<th align="right">y2</th>
<th align="right">y3</th>
<th align="right">y4</th>
<th align="right">y5</th>
<th align="right">y6</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1984</td>
<td align="right">167</td>
<td align="right">10</td>
<td align="right">3</td>
<td align="right">154</td>
<td align="right">12</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="right">1985</td>
<td align="right">264</td>
<td align="right">37</td>
<td align="right">11</td>
<td align="right">216</td>
<td align="right">21</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">1986</td>
<td align="right">130</td>
<td align="right">28</td>
<td align="right">9</td>
<td align="right">93</td>
<td align="right">5</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">1987</td>
<td align="right">16</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="right">1988</td>
<td align="right">226</td>
<td align="right">35</td>
<td align="right">8</td>
<td align="right">183</td>
<td align="right">12</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1989</td>
<td align="right">235</td>
<td align="right">31</td>
<td align="right">5</td>
<td align="right">199</td>
<td align="right">56</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">15</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">2</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">1991</td>
<td align="right">44</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">44</td>
<td align="right">23</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1992</td>
<td align="right">31</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">4</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1993</td>
<td align="right">100</td>
<td align="right">17</td>
<td align="right">2</td>
<td align="right">81</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1994</td>
<td align="right">32</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">18</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">1995</td>
<td align="right">109</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">102</td>
<td align="right">39</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="right">1996</td>
<td align="right">70</td>
<td align="right">13</td>
<td align="right">2</td>
<td align="right">55</td>
<td align="right">25</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="right">1997</td>
<td align="right">56</td>
<td align="right">19</td>
<td align="right">3</td>
<td align="right">34</td>
<td align="right">12</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1998</td>
<td align="right">34</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">30</td>
<td align="right">6</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="right">1999</td>
<td align="right">154</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">148</td>
<td align="right">23</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="right">2000</td>
<td align="right">53</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">53</td>
<td align="right">4</td>
<td align="right">33</td>
</tr>
</tbody>
</table>
<p>For each year <span class="math inline">\(t\)</span> from <span class="math inline">\(1984\)</span> to <span class="math inline">\(2000\)</span>, <span class="math inline">\(y_{1,t}\)</span> denotes the number of fish
trapped at the Cerisel station (close to the mouth of the river). <span class="math inline">\(y_{2,t}+y_{3,t}\)</span> individuals from the
captured ones are not replaced upstream, either because they died during
manipulation or because they are removed for experimental use or for
hatchery production. Let <span class="math inline">\(y_{4,t}=y_{1,t}-(y_{2,t}+y_{3,t})\)</span> the
number of (tagged) fish released. These spawners are individually marked
before they keep on swimming upstream . The recapture sample is gathered
during and after spawning (see more details on recapture conditions
hereafter). Let us denote as <span class="math inline">\(y_{5,t}\)</span> and <span class="math inline">\(y_{6,t}\)</span> the number of marked and unmarked
fish among recaptured fish, respectively.</p>
<center>
<div class="figure">
<img src="figures/CmrOir/CeriselTrap.png" style="width:80.0%;height:80.0%" alt=""><p class="caption">Figure 2 – Scheme of the Cerisel trapping facility
(Oir river, Normandy, France) working as a double downstream (for smolt
runs) and upstream (for spawner runs) partial counting fence. The black
circles at the top of the figure indicates the release site of tagged
smolts and spawners. The release site and the downstream trap are 1 km
away from each other.</p>
</div>
</center>
</div>
<div class="section level2">
<h2 id="modeling">Modeling<a class="anchor" aria-label="anchor" href="#modeling"></a>
</h2>
<div class="section level3">
<h3 id="observation-submodels-for-the-first-phace-cerisel-trapping-place">Observation submodels for the first phace (Cerisel trapping
place)<a class="anchor" aria-label="anchor" href="#observation-submodels-for-the-first-phace-cerisel-trapping-place"></a>
</h3>
<p>Let,</p>
<ul>
<li>
<span class="math inline">\(\nu_t\)</span> be the population size of
spawners at year <span class="math inline">\(t\)</span>
</li>
<li>
<span class="math inline">\(\pi_t^1\)</span> be the unknown trapping
efficiency,</li>
</ul>
<p>and assume all of the <span class="math inline">\(\nu_t\)</span>
spawners are independently and equally catchable in the trop with a
probability <span class="math inline">\(\pi^1_t\)</span> constant over
the migration season. Then, the number of fish trrapped at the counting
fence during migration time is the result of a Binomial experiment:</p>
<ul>
<li>
<span class="math inline">\(y_{1,t} \sim Binomial(\nu_t,
\pi^1_t)\)</span>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="observation-submodels-for-the-second-phase-re-collection-during-and-after-spawning">Observation submodels for the second phase (re-collection during and
after spawning)<a class="anchor" aria-label="anchor" href="#observation-submodels-for-the-second-phase-re-collection-during-and-after-spawning"></a>
</h3>
<p>The recapture sample is obtrainged by three methods: electrofishing
on the spawning grounds, collection of dead fish after spawning, and
trapping of spent fish at the downstram trap of the Cerisel facility.
Modeling recapture with Binomial experiments with effeciency <span class="math inline">\(\pi^2_t\)</span> is reasonable assuming the three
following hypotheses: No spawner runs downstream after getting over the
trap (<span class="math inline">\(H1\)</span>); there is no tag shedding
(<span class="math inline">\(H2\)</span>); the recapture probability
<span class="math inline">\(\pi_{t}^{2}\)</span> is the same for all the
fish whether or not marked (<span class="math inline">\(H3\)</span>):</p>
<ul>
<li><span class="math inline">\(y_{5,t} \sim Binomial(y_{4,t},
\pi^2_t)\)</span></li>
<li><span class="math inline">\(y_{6,t} \sim Binomial(\nu_t - y_{1,t},
\pi^2_t)\)</span></li>
</ul>
</div>
<div class="section level3">
<h3 id="latent-layers">Latent layers<a class="anchor" aria-label="anchor" href="#latent-layers"></a>
</h3>
<p>Let <span class="math inline">\(Z_t = (\nu_t, \pi^1_t,
\pi^2_t)\)</span> be the latent vector and <span class="math inline">\(y_t = (y_{1,t}, y_{5,t}, y_{6,t})\)</span> the
observations. The natural choice for the latent distributions are the
Beta distribtion for <span class="math inline">\(\pi^1_t\)</span> and
<span class="math inline">\(\pi^2_t\)</span> and the Negative Binomial
ditribution for <span class="math inline">\(\nu_t\)</span>:</p>
<ul>
<li><span class="math inline">\(\pi^1_t \sim Beta(a_1,
b_1)\)</span></li>
<li><span class="math inline">\(\pi^2_t \sim Beta(a_2,
b_2)\)</span></li>
<li><span class="math inline">\(\nu_t \sim
NegBinomial(c,d)\)</span></li>
</ul>
<center>
<div class="figure">
<img src="figures/CmrOir/DAG_CMR_Oir_Hierarchical.png" style="width:80.0%;height:80.0%" alt=""><p class="caption">Figure 3 – Directed Acyclic Graph representation of
the hierarchical structure for the joint modeling of
capture-mark-recapture experiments for the 17 years.</p>
</div>
</center>
<p>We assign a diffuse prior distribution to the higher level parameters
<span class="math inline">\(\theta = (a_1, a_2, b_1, b_2, c, d)\)</span>
to reflect some ignorance about them. We use the following transform
which recovers well understood meaning. For the trapping efficiency:</p>
<ul>
<li>
<span class="math inline">\(\mu_{a,b} = \frac{a}{a+b}\)</span> is
the mean of the Beta distribution, with <span class="math inline">\(\mu_{a,b} \sim Beta(1.5, 1.5)\)</span>
</li>
<li>
<span class="math inline">\(u_{a,b} = a+b\)</span> can be
interpreted as a prior sample size that scale the variance of the Beta
distribution, with <span class="math inline">\(\log(u_{a,b} \sim
Uniform(0,10)\)</span>).</li>
</ul>
<p>For the number of spawners:</p>
<ul>
<li>
<span class="math inline">\(\mu_{c,d} = \frac{c}{d}\)</span> is the
mean of the Negative Binomial distribution, with <span class="math inline">\(\mu_{c,d} \sim Uniform(0, \mu_{max})\)</span>,
where <span class="math inline">\(\mu_{max} = 3000\)</span> fish.</li>
<li>
<span class="math inline">\(\sigma^2_{c,d} =
\frac{c(d+1)}{d^2}\)</span> is the variance of the Negative Binomial
distrution, with <span class="math inline">\(\log(\sigma_{c,d}) \sim
Uniform(\log(\mu_{c,d}), \log(\sigma^2_{max}))\)</span>, where <span class="math inline">\(\sigma^2_{max} = 12\)</span> since we do not
believe that the standard deviation might exceed <span class="math inline">\(400\)</span> fish.</li>
</ul>
</div>
<div class="section level3">
<h3 id="independent-modeling">Independent modeling<a class="anchor" aria-label="anchor" href="#independent-modeling"></a>
</h3>
<p>To show how a transfer of information between years is organized by
the hierarchical model, we compare its results with the model assuming
independence between years. For the models with independence,
independent prior distributions with known parameters were set on <span class="math inline">\((\nu_{t},\pi_{t}% ^{1},\pi_{t}^{2})\)</span>:</p>
<ul>
<li><span class="math inline">\(\pi_{t}^{1} \; \sim \;
Beta(1.5,1.5)\)</span></li>
<li><span class="math inline">\(\pi_{t}^{2} \; \sim \;
Beta(1.5,1.5)\)</span></li>
<li><span class="math inline">\(\nu_{t} \; \sim \;
Uniform(1,3000)\)</span></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="implementation-results-and-analysis">Implementation, results and analysis<a class="anchor" aria-label="anchor" href="#implementation-results-and-analysis"></a>
</h2>
<div class="section level3">
<h3 id="independent-model">Independent model<a class="anchor" aria-label="anchor" href="#independent-model"></a>
</h3>
<p>The model can be written in <code>rjags</code> as the following
string:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_model_str</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  model { </span></span>
<span><span class="st"></span></span>
<span><span class="st">    # N = 17 years (1984 to 2000)</span></span>
<span><span class="st">    pnu &lt;- rep(1, 3000)</span></span>
<span><span class="st">    for (i in 1:N)</span></span>
<span><span class="st">      {</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Prior for trapping efficiency pi1</span></span>
<span><span class="st"></span></span>
<span><span class="st">      pi1[i] ~ dbeta(1.5,1.5)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Prior for recapture efficiency pi2</span></span>
<span><span class="st"></span></span>
<span><span class="st">      pi2[i] ~ dbeta(1.5,1.5)</span></span>
<span><span class="st">      nu[i] ~ dcat(pnu[])</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Escapement (number of fish that mate)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      Nsp[i] &lt;- max(nu[i]-y2[i]-y3[i],0)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Number of unmarked fish</span></span>
<span><span class="st"></span></span>
<span><span class="st">      nm[i] &lt;- max(nu[i]-y1[i],0)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      #  Likelihood (binomial for capture and recapture)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      y1[i] ~ dbin(pi1[i],nu[i])</span></span>
<span><span class="st">      y6[i] ~ dbin(pi2[i],nm[i])</span></span>
<span><span class="st">      y5[i] ~ dbin(pi2[i],y4[i])</span></span>
<span><span class="st">    </span></span>
<span><span class="st">} # end of loop on year i</span></span>
<span><span class="st"></span></span>
<span><span class="st">} # end of model"</span></span></code></pre></div>
<p>And we fix the following initialization points for each of the three
chains.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_init</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">300</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.2</span>,<span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.8</span>,<span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">ind_model_str</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">CmrOir</span>, inits <span class="op">=</span> <span class="va">ind_init</span>,</span>
<span>                    n.chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 51</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 51</span></span>
<span><span class="co">#&gt;    Total graph size: 244</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="co"># Inferences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ind_model</span>, n.iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">posterior_sample_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/coda.samples.html" class="external-link">coda.samples</a></span><span class="op">(</span><span class="va">ind_model</span>,</span>
<span>                       variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pi1"</span>, <span class="st">"pi2"</span>, <span class="st">"nu"</span><span class="op">)</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                       thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="diagnostic">Diagnostic<a class="anchor" aria-label="anchor" href="#diagnostic"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">posterior_sample_ind</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">default_convergence_measures</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variable</th>
<th align="right">rhat</th>
<th align="right">ess_bulk</th>
<th align="right">ess_tail</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">nu[1]</td>
<td align="right">1.0013690</td>
<td align="right">993.8650</td>
<td align="right">1402.8073</td>
</tr>
<tr class="even">
<td align="left">nu[2]</td>
<td align="right">1.0019188</td>
<td align="right">1301.0693</td>
<td align="right">1817.1009</td>
</tr>
<tr class="odd">
<td align="left">nu[3]</td>
<td align="right">1.0047103</td>
<td align="right">696.9189</td>
<td align="right">939.2453</td>
</tr>
<tr class="even">
<td align="left">nu[4]</td>
<td align="right">1.0043067</td>
<td align="right">1093.5905</td>
<td align="right">1601.1423</td>
</tr>
<tr class="odd">
<td align="left">nu[5]</td>
<td align="right">1.0019027</td>
<td align="right">1022.9990</td>
<td align="right">1278.6559</td>
</tr>
<tr class="even">
<td align="left">nu[6]</td>
<td align="right">1.0004007</td>
<td align="right">2659.7480</td>
<td align="right">2936.2192</td>
</tr>
<tr class="odd">
<td align="left">nu[7]</td>
<td align="right">1.0004199</td>
<td align="right">1561.2548</td>
<td align="right">1785.0422</td>
</tr>
<tr class="even">
<td align="left">nu[8]</td>
<td align="right">0.9998430</td>
<td align="right">2682.8475</td>
<td align="right">2880.7041</td>
</tr>
<tr class="odd">
<td align="left">nu[9]</td>
<td align="right">1.0002507</td>
<td align="right">2026.1694</td>
<td align="right">2364.0482</td>
</tr>
<tr class="even">
<td align="left">nu[10]</td>
<td align="right">1.0007880</td>
<td align="right">835.2781</td>
<td align="right">1192.8109</td>
</tr>
<tr class="odd">
<td align="left">nu[11]</td>
<td align="right">1.0008658</td>
<td align="right">1139.6212</td>
<td align="right">1296.5161</td>
</tr>
<tr class="even">
<td align="left">nu[12]</td>
<td align="right">1.0007640</td>
<td align="right">2835.5706</td>
<td align="right">2970.8976</td>
</tr>
<tr class="odd">
<td align="left">nu[13]</td>
<td align="right">0.9997233</td>
<td align="right">2644.7484</td>
<td align="right">2416.3082</td>
</tr>
<tr class="even">
<td align="left">nu[14]</td>
<td align="right">1.0015857</td>
<td align="right">2567.8427</td>
<td align="right">2769.8569</td>
</tr>
<tr class="odd">
<td align="left">nu[15]</td>
<td align="right">1.0000188</td>
<td align="right">1724.8200</td>
<td align="right">2041.7691</td>
</tr>
<tr class="even">
<td align="left">nu[16]</td>
<td align="right">0.9998513</td>
<td align="right">2208.8187</td>
<td align="right">2771.5664</td>
</tr>
<tr class="odd">
<td align="left">nu[17]</td>
<td align="right">1.0047596</td>
<td align="right">852.9044</td>
<td align="right">1214.2785</td>
</tr>
<tr class="even">
<td align="left">pi1[1]</td>
<td align="right">1.0013372</td>
<td align="right">974.9461</td>
<td align="right">1425.9177</td>
</tr>
<tr class="odd">
<td align="left">pi1[2]</td>
<td align="right">1.0017211</td>
<td align="right">1288.5764</td>
<td align="right">1998.3713</td>
</tr>
<tr class="even">
<td align="left">pi1[3]</td>
<td align="right">1.0041901</td>
<td align="right">716.0069</td>
<td align="right">969.2572</td>
</tr>
<tr class="odd">
<td align="left">pi1[4]</td>
<td align="right">1.0036057</td>
<td align="right">1248.7285</td>
<td align="right">1520.3286</td>
</tr>
<tr class="even">
<td align="left">pi1[5]</td>
<td align="right">1.0020058</td>
<td align="right">1027.5631</td>
<td align="right">1278.2841</td>
</tr>
<tr class="odd">
<td align="left">pi1[6]</td>
<td align="right">1.0000219</td>
<td align="right">2686.6746</td>
<td align="right">2945.4777</td>
</tr>
<tr class="even">
<td align="left">pi1[7]</td>
<td align="right">1.0011686</td>
<td align="right">1667.8347</td>
<td align="right">1673.9751</td>
</tr>
<tr class="odd">
<td align="left">pi1[8]</td>
<td align="right">1.0017163</td>
<td align="right">2986.1406</td>
<td align="right">2824.9457</td>
</tr>
<tr class="even">
<td align="left">pi1[9]</td>
<td align="right">1.0006148</td>
<td align="right">2074.6710</td>
<td align="right">2481.0897</td>
</tr>
<tr class="odd">
<td align="left">pi1[10]</td>
<td align="right">1.0011731</td>
<td align="right">847.9701</td>
<td align="right">1228.4709</td>
</tr>
<tr class="even">
<td align="left">pi1[11]</td>
<td align="right">1.0006020</td>
<td align="right">1091.6438</td>
<td align="right">1381.1840</td>
</tr>
<tr class="odd">
<td align="left">pi1[12]</td>
<td align="right">1.0000989</td>
<td align="right">2970.5276</td>
<td align="right">2988.4496</td>
</tr>
<tr class="even">
<td align="left">pi1[13]</td>
<td align="right">1.0002324</td>
<td align="right">2717.8513</td>
<td align="right">2878.4232</td>
</tr>
<tr class="odd">
<td align="left">pi1[14]</td>
<td align="right">0.9996568</td>
<td align="right">2805.3258</td>
<td align="right">2829.3109</td>
</tr>
<tr class="even">
<td align="left">pi1[15]</td>
<td align="right">1.0004164</td>
<td align="right">1871.1486</td>
<td align="right">2035.4621</td>
</tr>
<tr class="odd">
<td align="left">pi1[16]</td>
<td align="right">0.9996745</td>
<td align="right">2209.9208</td>
<td align="right">2755.1743</td>
</tr>
<tr class="even">
<td align="left">pi1[17]</td>
<td align="right">1.0043925</td>
<td align="right">867.3266</td>
<td align="right">1249.9307</td>
</tr>
<tr class="odd">
<td align="left">pi2[1]</td>
<td align="right">1.0016015</td>
<td align="right">1406.6701</td>
<td align="right">2134.6575</td>
</tr>
<tr class="even">
<td align="left">pi2[2]</td>
<td align="right">1.0004181</td>
<td align="right">2505.9535</td>
<td align="right">2771.2567</td>
</tr>
<tr class="odd">
<td align="left">pi2[3]</td>
<td align="right">1.0003594</td>
<td align="right">1250.1963</td>
<td align="right">1850.7094</td>
</tr>
<tr class="even">
<td align="left">pi2[4]</td>
<td align="right">1.0053972</td>
<td align="right">1091.9978</td>
<td align="right">1696.1680</td>
</tr>
<tr class="odd">
<td align="left">pi2[5]</td>
<td align="right">1.0003103</td>
<td align="right">2565.7296</td>
<td align="right">2791.5070</td>
</tr>
<tr class="even">
<td align="left">pi2[6]</td>
<td align="right">0.9999579</td>
<td align="right">2652.4572</td>
<td align="right">2733.7803</td>
</tr>
<tr class="odd">
<td align="left">pi2[7]</td>
<td align="right">1.0006617</td>
<td align="right">1645.5332</td>
<td align="right">2024.3918</td>
</tr>
<tr class="even">
<td align="left">pi2[8]</td>
<td align="right">1.0005218</td>
<td align="right">2879.1677</td>
<td align="right">2839.1901</td>
</tr>
<tr class="odd">
<td align="left">pi2[9]</td>
<td align="right">1.0008550</td>
<td align="right">2117.5513</td>
<td align="right">2412.4405</td>
</tr>
<tr class="even">
<td align="left">pi2[10]</td>
<td align="right">1.0008445</td>
<td align="right">1471.3449</td>
<td align="right">2052.5595</td>
</tr>
<tr class="odd">
<td align="left">pi2[11]</td>
<td align="right">1.0001669</td>
<td align="right">1418.7802</td>
<td align="right">2134.3629</td>
</tr>
<tr class="even">
<td align="left">pi2[12]</td>
<td align="right">1.0015196</td>
<td align="right">2949.2289</td>
<td align="right">2616.5255</td>
</tr>
<tr class="odd">
<td align="left">pi2[13]</td>
<td align="right">1.0001725</td>
<td align="right">2711.4697</td>
<td align="right">2908.0769</td>
</tr>
<tr class="even">
<td align="left">pi2[14]</td>
<td align="right">0.9996217</td>
<td align="right">2993.4374</td>
<td align="right">2988.8836</td>
</tr>
<tr class="odd">
<td align="left">pi2[15]</td>
<td align="right">1.0007358</td>
<td align="right">1865.2145</td>
<td align="right">2110.1324</td>
</tr>
<tr class="even">
<td align="left">pi2[16]</td>
<td align="right">1.0006582</td>
<td align="right">2660.0672</td>
<td align="right">2577.1729</td>
</tr>
<tr class="odd">
<td align="left">pi2[17]</td>
<td align="right">1.0033700</td>
<td align="right">920.0852</td>
<td align="right">1325.1539</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="hierarchical-model">Hierarchical model<a class="anchor" aria-label="anchor" href="#hierarchical-model"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hier_model_str</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  model { </span></span>
<span><span class="st"></span></span>
<span><span class="st">    # N = 17 years (1984 to 2000)</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    # Hyperprior for thetrapping efficiency</span></span>
<span><span class="st">    mu1_ab ~ dbeta(1.5, 1.5)</span></span>
<span><span class="st">    log_u1_ab ~ dunif(0,10)</span></span>
<span><span class="st">    u1_ab &lt;- exp(log_u1_ab)</span></span>
<span><span class="st">    alpha1 &lt;- mu1_ab * u1_ab</span></span>
<span><span class="st">    beta1 &lt;- (1-mu1_ab)*u1_ab</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    # Hyperprior for the recapture efficiency</span></span>
<span><span class="st">    mu2_ab ~ dbeta(1.5, 1.5)</span></span>
<span><span class="st">    log_u2_ab ~ dunif(0,10)</span></span>
<span><span class="st">    u2_ab &lt;- exp(log_u2_ab)</span></span>
<span><span class="st">    alpha2 &lt;- mu2_ab * u2_ab</span></span>
<span><span class="st">    beta2 &lt;- (1-mu2_ab)*u2_ab</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    # Hyperperior for nu_max</span></span>
<span><span class="st">    pmunu &lt;- rep(1, 3000)</span></span>
<span><span class="st">    mu_nu ~ dcat(pmunu)</span></span>
<span><span class="st">    inf_log_sig2_nu &lt;- log(mu_nu)</span></span>
<span><span class="st">    log_sig2_nu ~ dunif(inf_log_sig2_nu, 12)</span></span>
<span><span class="st">    sig2_nu &lt;- exp(log_sig2_nu)</span></span>
<span><span class="st">    p &lt;- mu_nu/sig2_nu  # d =  p/(1-p)</span></span>
<span><span class="st">    c &lt;- mu_nu * p*(1-p)</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    # Predictive distributions</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    pi1_pred ~ dbeta(alpha1, beta1)</span></span>
<span><span class="st">    pi2_pred ~ dbeta(alpha2, beta2)</span></span>
<span><span class="st"></span></span>
<span><span class="st">    nu_pred ~ dnegbin(p,c)</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    for (i in 1:N)</span></span>
<span><span class="st">      {</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Prior for trapping efficiency pi1</span></span>
<span><span class="st"></span></span>
<span><span class="st">      pi1[i] ~ dbeta(alpha1, beta1)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Prior for recapture efficiency pi2</span></span>
<span><span class="st"></span></span>
<span><span class="st">      pi2[i] ~ dbeta(alpha2, beta2)</span></span>
<span><span class="st">      nu[i] ~ dnegbin(p,c)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Escapement (number of fish that mate)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      Nsp[i] &lt;- max(nu[i]-y2[i]-y3[i],0)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      # Number of unmarked fish</span></span>
<span><span class="st"></span></span>
<span><span class="st">      nm[i] &lt;- max(nu[i]-y1[i],0)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      #  Likelihood (binomial for capture and recapture)</span></span>
<span><span class="st"></span></span>
<span><span class="st">      y1[i] ~ dbin(pi1[i],nu[i])</span></span>
<span><span class="st">      y6[i] ~ dbin(pi2[i],nm[i])</span></span>
<span><span class="st">      y5[i] ~ dbin(pi2[i],y4[i])</span></span>
<span><span class="st">    </span></span>
<span><span class="st">} # end of loop on year i</span></span>
<span><span class="st"></span></span>
<span><span class="st">} # end of model"</span></span></code></pre></div>
<p>And we fix the following initialization points for each of the three
chains.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hier_init</span> <span class="op">&lt;-</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi1_pred <span class="op">=</span> <span class="fl">.5</span>, mu1_ab <span class="op">=</span> <span class="fl">.6</span>,  log_u1_ab <span class="op">=</span> <span class="fl">.6</span>,</span>
<span>       pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2_pred <span class="op">=</span> <span class="fl">.2</span>, mu2_ab <span class="op">=</span> <span class="fl">.6</span>,  log_u2_ab <span class="op">=</span> <span class="fl">.6</span>, </span>
<span>       nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">300</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu_pred <span class="op">=</span> <span class="fl">300</span>, mu_nu <span class="op">=</span> <span class="fl">10</span>, log_sig2_nu <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi1_pred <span class="op">=</span> <span class="fl">.2</span>, mu1_ab <span class="op">=</span> <span class="fl">.5</span>,  log_u1_ab <span class="op">=</span> <span class="fl">.25</span>,</span>
<span>       pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2_pred <span class="op">=</span> <span class="fl">.2</span>, mu2_ab <span class="op">=</span> <span class="fl">.5</span>,  log_u2_ab <span class="op">=</span> <span class="fl">.25</span>, </span>
<span>       nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu_pred <span class="op">=</span> <span class="fl">500</span>, mu_nu <span class="op">=</span> <span class="fl">50</span>, log_sig2_nu <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pi1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi1_pred <span class="op">=</span> <span class="fl">.5</span>, mu1_ab <span class="op">=</span> <span class="fl">.5</span>,  log_u1_ab <span class="op">=</span> <span class="fl">.25</span>,</span>
<span>       pi2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, pi2_pred <span class="op">=</span> <span class="fl">.5</span>, mu2_ab <span class="op">=</span> <span class="fl">.5</span>,  log_u2_ab <span class="op">=</span> <span class="fl">.25</span>, </span>
<span>       nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="va">CmrOir</span><span class="op">$</span><span class="va">N</span><span class="op">)</span>, nu_pred <span class="op">=</span> <span class="fl">1000</span>, mu_nu <span class="op">=</span> <span class="fl">100</span>, log_sig2_nu <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hier_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">hier_model_str</span><span class="op">)</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">CmrOir</span>, inits <span class="op">=</span> <span class="va">hier_init</span>,</span>
<span>                    n.chains <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Compiling model graph</span></span>
<span><span class="co">#&gt;    Resolving undeclared variables</span></span>
<span><span class="co">#&gt;    Allocating nodes</span></span>
<span><span class="co">#&gt; Graph information:</span></span>
<span><span class="co">#&gt;    Observed stochastic nodes: 51</span></span>
<span><span class="co">#&gt;    Unobserved stochastic nodes: 60</span></span>
<span><span class="co">#&gt;    Total graph size: 268</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initializing model</span></span>
<span></span>
<span><span class="co"># Inferences</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pi1"</span>, <span class="st">"pi1_pred"</span>, <span class="st">"mu1_ab"</span>, <span class="st">"u1_ab"</span>,</span>
<span>           <span class="st">"pi2"</span>, <span class="st">"pi2_pred"</span>, <span class="st">"mu2_ab"</span>, <span class="st">"u2_ab"</span>, </span>
<span>           <span class="st">"nu"</span>, <span class="st">"nu_pred"</span>, <span class="st">"mu_nu"</span>, <span class="st">"log_sig2_nu"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">hier_model</span>, n.iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">posterior_sample_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/coda.samples.html" class="external-link">coda.samples</a></span><span class="op">(</span><span class="va">hier_model</span>,</span>
<span>                       variable.names <span class="op">=</span> <span class="va">pars</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                       thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="diagnostic-1">Diagnostic<a class="anchor" aria-label="anchor" href="#diagnostic-1"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">posterior_sample_hier</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">default_convergence_measures</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variable</th>
<th align="right">rhat</th>
<th align="right">ess_bulk</th>
<th align="right">ess_tail</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">log_sig2_nu</td>
<td align="right">0.9997319</td>
<td align="right">2395.384</td>
<td align="right">2669.261</td>
</tr>
<tr class="even">
<td align="left">mu1_ab</td>
<td align="right">1.0019660</td>
<td align="right">2661.879</td>
<td align="right">2704.381</td>
</tr>
<tr class="odd">
<td align="left">mu2_ab</td>
<td align="right">0.9996043</td>
<td align="right">2624.235</td>
<td align="right">2893.343</td>
</tr>
<tr class="even">
<td align="left">mu_nu</td>
<td align="right">0.9994781</td>
<td align="right">2275.223</td>
<td align="right">2604.974</td>
</tr>
<tr class="odd">
<td align="left">nu[1]</td>
<td align="right">1.0011896</td>
<td align="right">1554.654</td>
<td align="right">1908.692</td>
</tr>
<tr class="even">
<td align="left">nu[2]</td>
<td align="right">1.0021367</td>
<td align="right">1624.971</td>
<td align="right">2254.885</td>
</tr>
<tr class="odd">
<td align="left">nu[3]</td>
<td align="right">1.0030374</td>
<td align="right">1050.078</td>
<td align="right">1679.898</td>
</tr>
<tr class="even">
<td align="left">nu[4]</td>
<td align="right">1.0009683</td>
<td align="right">1299.503</td>
<td align="right">2230.798</td>
</tr>
<tr class="odd">
<td align="left">nu[5]</td>
<td align="right">1.0000910</td>
<td align="right">1246.117</td>
<td align="right">1293.924</td>
</tr>
<tr class="even">
<td align="left">nu[6]</td>
<td align="right">0.9996345</td>
<td align="right">2522.676</td>
<td align="right">2617.274</td>
</tr>
<tr class="odd">
<td align="left">nu[7]</td>
<td align="right">1.0005535</td>
<td align="right">1588.662</td>
<td align="right">2498.688</td>
</tr>
<tr class="even">
<td align="left">nu[8]</td>
<td align="right">1.0003906</td>
<td align="right">2945.202</td>
<td align="right">2953.627</td>
</tr>
<tr class="odd">
<td align="left">nu[9]</td>
<td align="right">1.0012364</td>
<td align="right">1353.796</td>
<td align="right">2203.618</td>
</tr>
<tr class="even">
<td align="left">nu[10]</td>
<td align="right">1.0018569</td>
<td align="right">1230.897</td>
<td align="right">1571.830</td>
</tr>
<tr class="odd">
<td align="left">nu[11]</td>
<td align="right">1.0015666</td>
<td align="right">1267.747</td>
<td align="right">2095.106</td>
</tr>
<tr class="even">
<td align="left">nu[12]</td>
<td align="right">1.0001599</td>
<td align="right">3007.668</td>
<td align="right">2586.552</td>
</tr>
<tr class="odd">
<td align="left">nu[13]</td>
<td align="right">0.9994760</td>
<td align="right">2569.897</td>
<td align="right">2742.954</td>
</tr>
<tr class="even">
<td align="left">nu[14]</td>
<td align="right">1.0003968</td>
<td align="right">2675.193</td>
<td align="right">2313.388</td>
</tr>
<tr class="odd">
<td align="left">nu[15]</td>
<td align="right">1.0023591</td>
<td align="right">2018.946</td>
<td align="right">2427.733</td>
</tr>
<tr class="even">
<td align="left">nu[16]</td>
<td align="right">0.9996841</td>
<td align="right">2130.689</td>
<td align="right">2468.704</td>
</tr>
<tr class="odd">
<td align="left">nu[17]</td>
<td align="right">1.0027445</td>
<td align="right">1627.417</td>
<td align="right">2203.366</td>
</tr>
<tr class="even">
<td align="left">nu_pred</td>
<td align="right">1.0015837</td>
<td align="right">2746.470</td>
<td align="right">2720.931</td>
</tr>
<tr class="odd">
<td align="left">pi1[1]</td>
<td align="right">1.0016010</td>
<td align="right">1528.499</td>
<td align="right">2088.597</td>
</tr>
<tr class="even">
<td align="left">pi1[2]</td>
<td align="right">1.0033526</td>
<td align="right">1587.426</td>
<td align="right">2098.956</td>
</tr>
<tr class="odd">
<td align="left">pi1[3]</td>
<td align="right">1.0029123</td>
<td align="right">1115.654</td>
<td align="right">1764.632</td>
</tr>
<tr class="even">
<td align="left">pi1[4]</td>
<td align="right">1.0002038</td>
<td align="right">1625.597</td>
<td align="right">2489.303</td>
</tr>
<tr class="odd">
<td align="left">pi1[5]</td>
<td align="right">0.9995230</td>
<td align="right">1302.381</td>
<td align="right">1359.398</td>
</tr>
<tr class="even">
<td align="left">pi1[6]</td>
<td align="right">0.9997740</td>
<td align="right">2623.877</td>
<td align="right">2829.082</td>
</tr>
<tr class="odd">
<td align="left">pi1[7]</td>
<td align="right">1.0016581</td>
<td align="right">1575.385</td>
<td align="right">2229.445</td>
</tr>
<tr class="even">
<td align="left">pi1[8]</td>
<td align="right">0.9999254</td>
<td align="right">2925.307</td>
<td align="right">2878.503</td>
</tr>
<tr class="odd">
<td align="left">pi1[9]</td>
<td align="right">1.0008627</td>
<td align="right">1376.934</td>
<td align="right">2317.700</td>
</tr>
<tr class="even">
<td align="left">pi1[10]</td>
<td align="right">1.0011772</td>
<td align="right">1229.514</td>
<td align="right">1726.110</td>
</tr>
<tr class="odd">
<td align="left">pi1[11]</td>
<td align="right">1.0023860</td>
<td align="right">1263.814</td>
<td align="right">1940.431</td>
</tr>
<tr class="even">
<td align="left">pi1[12]</td>
<td align="right">1.0010282</td>
<td align="right">3063.732</td>
<td align="right">2677.979</td>
</tr>
<tr class="odd">
<td align="left">pi1[13]</td>
<td align="right">0.9999112</td>
<td align="right">2713.748</td>
<td align="right">2455.949</td>
</tr>
<tr class="even">
<td align="left">pi1[14]</td>
<td align="right">1.0011365</td>
<td align="right">2372.484</td>
<td align="right">2448.762</td>
</tr>
<tr class="odd">
<td align="left">pi1[15]</td>
<td align="right">1.0000181</td>
<td align="right">1931.741</td>
<td align="right">2721.123</td>
</tr>
<tr class="even">
<td align="left">pi1[16]</td>
<td align="right">1.0002541</td>
<td align="right">2235.443</td>
<td align="right">2666.400</td>
</tr>
<tr class="odd">
<td align="left">pi1[17]</td>
<td align="right">1.0001212</td>
<td align="right">1817.507</td>
<td align="right">2298.095</td>
</tr>
<tr class="even">
<td align="left">pi1_pred</td>
<td align="right">1.0002161</td>
<td align="right">2665.024</td>
<td align="right">3040.714</td>
</tr>
<tr class="odd">
<td align="left">pi2[1]</td>
<td align="right">1.0005623</td>
<td align="right">2214.258</td>
<td align="right">2484.804</td>
</tr>
<tr class="even">
<td align="left">pi2[2]</td>
<td align="right">1.0013452</td>
<td align="right">2659.608</td>
<td align="right">2688.503</td>
</tr>
<tr class="odd">
<td align="left">pi2[3]</td>
<td align="right">1.0027861</td>
<td align="right">1455.231</td>
<td align="right">2294.388</td>
</tr>
<tr class="even">
<td align="left">pi2[4]</td>
<td align="right">1.0000595</td>
<td align="right">1535.814</td>
<td align="right">2356.742</td>
</tr>
<tr class="odd">
<td align="left">pi2[5]</td>
<td align="right">1.0002026</td>
<td align="right">2820.090</td>
<td align="right">2905.713</td>
</tr>
<tr class="even">
<td align="left">pi2[6]</td>
<td align="right">1.0000021</td>
<td align="right">2674.456</td>
<td align="right">2430.697</td>
</tr>
<tr class="odd">
<td align="left">pi2[7]</td>
<td align="right">1.0006700</td>
<td align="right">1801.042</td>
<td align="right">2519.803</td>
</tr>
<tr class="even">
<td align="left">pi2[8]</td>
<td align="right">1.0012373</td>
<td align="right">2720.970</td>
<td align="right">2740.133</td>
</tr>
<tr class="odd">
<td align="left">pi2[9]</td>
<td align="right">1.0006231</td>
<td align="right">1773.399</td>
<td align="right">2573.889</td>
</tr>
<tr class="even">
<td align="left">pi2[10]</td>
<td align="right">1.0006133</td>
<td align="right">2130.209</td>
<td align="right">2412.496</td>
</tr>
<tr class="odd">
<td align="left">pi2[11]</td>
<td align="right">1.0017309</td>
<td align="right">1702.560</td>
<td align="right">2417.880</td>
</tr>
<tr class="even">
<td align="left">pi2[12]</td>
<td align="right">0.9999596</td>
<td align="right">2952.623</td>
<td align="right">2928.377</td>
</tr>
<tr class="odd">
<td align="left">pi2[13]</td>
<td align="right">0.9995414</td>
<td align="right">2474.594</td>
<td align="right">2684.712</td>
</tr>
<tr class="even">
<td align="left">pi2[14]</td>
<td align="right">1.0006674</td>
<td align="right">2592.162</td>
<td align="right">2387.218</td>
</tr>
<tr class="odd">
<td align="left">pi2[15]</td>
<td align="right">1.0004399</td>
<td align="right">2032.824</td>
<td align="right">2570.932</td>
</tr>
<tr class="even">
<td align="left">pi2[16]</td>
<td align="right">1.0003019</td>
<td align="right">2608.952</td>
<td align="right">2624.330</td>
</tr>
<tr class="odd">
<td align="left">pi2[17]</td>
<td align="right">1.0010658</td>
<td align="right">1840.344</td>
<td align="right">2480.820</td>
</tr>
<tr class="even">
<td align="left">pi2_pred</td>
<td align="right">0.9993152</td>
<td align="right">3125.068</td>
<td align="right">3077.635</td>
</tr>
<tr class="odd">
<td align="left">u1_ab</td>
<td align="right">0.9993884</td>
<td align="right">2650.360</td>
<td align="right">2852.368</td>
</tr>
<tr class="even">
<td align="left">u2_ab</td>
<td align="right">1.0000074</td>
<td align="right">2462.765</td>
<td align="right">2983.584</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="results-and-analysis">Results and analysis<a class="anchor" aria-label="anchor" href="#results-and-analysis"></a>
</h3>
<p>We extract the results of both model into long form and wide form
data frames.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfl_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_longer.html">extract_longer</a></span><span class="op">(</span><span class="va">posterior_sample_ind</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Independent"</span><span class="op">)</span></span>
<span><span class="va">dfw_ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_wider.html">extract_wider</a></span><span class="op">(</span><span class="va">posterior_sample_ind</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Independent"</span><span class="op">)</span></span>
<span><span class="va">dfl_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_longer.html">extract_longer</a></span><span class="op">(</span><span class="va">posterior_sample_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Hierarchical"</span><span class="op">)</span></span>
<span><span class="va">dfw_hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_wider.html">extract_wider</a></span><span class="op">(</span><span class="va">posterior_sample_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="st">"Hierarchical"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="comparing-the-efficiency-and-number-of-spawners-distribution-for-both-models">Comparing the efficiency and number of spawners distribution for
both models<a class="anchor" aria-label="anchor" href="#comparing-the-efficiency-and-number-of-spawners-distribution-for-both-models"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfl_ind</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dfl_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="st">"^pi1\\."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1984</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># 5 = length("pi1.") + 1</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Years</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span>, outlier.size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray50"</span>, <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Trapping efficiency"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15L</span><span class="op">)</span></span></code></pre></div>
<p><img src="hierarchical-exchangeable-cmr_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfl_ind</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dfl_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="st">"^pi2\\."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1984</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># 5 = length("pi2.") + 1</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Years</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Model</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span>, outlier.size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray50"</span>, <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Recapture efficiency"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15L</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 14 rows containing non-finite values (stat_boxplot).</span></span></code></pre></div>
<p><img src="hierarchical-exchangeable-cmr_files/figure-html/unnamed-chunk-6-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfl_ind</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dfl_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="st">"^nu\\."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1984</span>,<span class="fl">2000</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># 4 = length("nu.") + 1</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Years</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">Model</span> <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>outlier.shape <span class="op">=</span> <span class="cn">NA</span>, outlier.size <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray50"</span>, <span class="st">"gray90"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Spawners"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Years"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15L</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 53 rows containing non-finite values (stat_boxplot).</span></span></code></pre></div>
<p><img src="hierarchical-exchangeable-cmr_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Results highlight that hierarchical modeling has no effect on the
inferences on the capture efficiencies but gratly improve posterior
inferences of psawners migrating back to the Oir River.</p>
<p>Posterior mean values of the capture probabilities <span class="math inline">\(\pi_{t}^{1}\)</span> do not seem to shrink much
toward their overall grand mean and the recapture probabilities <span class="math inline">\(\pi_{t}^{2}\)</span>’s are only slightly subjected
to the shrinkage effect. There remains a lot of between-year variability
in the experimental conditions at the Cerisel trapping facility.</p>
<p>Conversely, the hierarchical structure hypothesized on <span class="math inline">\(\nu_{t}\)</span>’s strongly reduces the skewness
and uncertainty in the estimation of the number of spawners. The grey
boxplots clearly point out that the most precise inferences are obtained
under the hierarchical model, especially for the years with sparse CMR
data, <em>i.e.</em>, low number of marked released or, more importantly,
low number of recaptures of previously marked fish yield (<em>e.g.</em>,
years <span class="math inline">\(1987\)</span>, <span class="math inline">\(1990\)</span>, <span class="math inline">\(1994\)</span> and <span class="math inline">\(2000\)</span>). For this latter year, the upper
bounds of the <span class="math inline">\(95\%\)</span> Bayesian
credibility intervals obtained with the model assuming independence
between years appears unrealistically high given the size of the Oir
River and the available knowledge on the biology and ecology of Atlantic
salmon as exemplified for year <span class="math inline">\(2000\)</span>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfw_ind</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dfw_hier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`nu.17`</span>, linetype <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Spawners"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15L</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 53 rows containing non-finite values (stat_density).</span></span></code></pre></div>
<p><img src="hierarchical-exchangeable-cmr_files/figure-html/unnamed-chunk-8-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="posterior-predictive-of-the-hierarchical-model">Posterior predictive of the hierarchical model<a class="anchor" aria-label="anchor" href="#posterior-predictive-of-the-hierarchical-model"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_df.html" class="external-link">as_draws_df</a></span><span class="op">(</span><span class="va">posterior_sample_hier</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">default_summary_measures</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">"pred"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   variable    mean  median      sd    mad      q5     q95</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> nu_pred  181.    157     116.    96.4   45      395.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> pi1_pred   0.595   0.636   0.299  0.379  0.074<span style="text-decoration: underline;">6</span>   0.990</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> pi2_pred   0.209   0.182   0.142  0.136  0.031<span style="text-decoration: underline;">3</span>   0.484</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">par.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Spawners"</span>, <span class="st">"Trapping efficiency"</span>, </span>
<span>              <span class="st">"Recapture efficiency"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">par.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nu_pred"</span>, <span class="st">"pi1_pred"</span>, <span class="st">"pi2_pred"</span><span class="op">)</span></span>
<span><span class="va">dfl_hier</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="st">"pred"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">parameter</span>, </span>
<span>              scales <span class="op">=</span> <span class="st">"free"</span>, </span>
<span>              labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="va">par.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15L</span><span class="op">)</span></span></code></pre></div>
<p><img src="hierarchical-exchangeable-cmr_files/figure-html/unnamed-chunk-10-1.png" width="700" style="display: block; margin: auto;"></p>
<!-- ```{r} -->
<!-- dfw_hier %>%  -->
<!--   select(mu1_ab, u1_ab) %>% -->
<!--   ggplot(aes(x = mu1_ab, y = u1_ab)) + -->
<!--   geom_density2d() -->
<!-- ``` -->
<p>A straightforward result of the hierarchical model are the posterior
predictive distributions of the trapping or recapture efficiencies and
of the number of returns , denoted <span class="math inline">\([\pi^{1,new}|data_{1984:2000}]\)</span> and <span class="math inline">\([\pi^{2,new}|data_{1984:2000}]\)</span>, and <span class="math inline">\([\nu^{new}|data_{1984:2000}],\)</span>
respectively. The posterior predictive of the recapture efficiency and
of the returns are informative distributions. Thus, the data of all
years combined allow discarding <em>a priori</em> the possibility of
very high trapping efficiency (<em>i.e.</em>, greater than 0.5) or high
spawner population size (<em>i.e.</em>, greater than a thousand) in any
additional year.</p>
<p>In-depth sensitivity analyses and another observation model for the
recaptures can be found in <span class="citation">Rivot and Prévost (<a href="#ref-RivotPrevost2002" role="doc-biblioref">2002</a>)</span>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-RivotPrevost2002" class="csl-entry">
Rivot, E., and E. Prévost. 2002. <span>“Hierarchical
<span>B</span>ayesian Analysis of Capture-Mark-Recapture Data.”</span>
<em>Canadian Journal of Fisheries and Aquatic Sciences</em> 59: 1768–84.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Saint-Clair Chabert-Liddell, Éric Parent, Étienne Rivot.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
